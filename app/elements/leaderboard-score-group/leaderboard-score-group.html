<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="leaderboard-score-group" attributes="userDetails holeNumber tournamentToScore roundToScore">
  <template>
    <link rel="stylesheet" href="leaderboard-score-group.css">
      <div id="GroupContent" class="group-content" flex vertical layout>
        <div class="card" flex vertical layout>
          <div class="group-view" flex>
            <div class="four-quarter">
              <div id="players" fit horizontal wrap layout>
                <template repeat="{{player in roundToScore.groupings[userDetails.uid].players}}">
                  <div class="player" layout vertical>
                    <div class="player__info" layout horizontal>
                      <div class="player__name">{{player.name}}</div>
                      <div class="player__handicap">{{player.handicap}}</div>
                      <div class="player__score" flex>{{player.score ? player.score: '0'}} pts</div>
                    </div>
                    <div class="player__score" layout vertical flex>
                      <div class="player__score-input-container" layout horizontal center-center flex>
                        <div class="player__score-input-minus">
                          <paper-fab mini icon="remove"></paper-fab>
                        </div>
                        <div class="player__score-input" flex>5</div>
                        <div class="player__score-input-plus">
                          <paper-fab mini icon="add"></paper-fab></div>
                      </div>
                      <!-- ToDo - Look into a tall media query so we can add quick buttons -->
                      <div showing?="{{tall}}" class="player__score-quick-button-container" layout horizontal>
                        <div class="player__score-quick-button  player__score-quick-button--birdie" flex>
                          <span>-1</span>
                        </div>
                        <div class="player__score-quick-button  player__score-quick-button--par" flex>
                          <span>par</span>
                        </div>
                        <div class="player__score-quick-button  player__score-quick-button--bogey" flex>
                          <span>+1</span>
                        </div>
                        <div class="player__score-quick-button  player__score-quick-button--double-bogey" flex>
                          <span>+2</span>
                        </div>
                        <div class="player__score-quick-button  player__score-quick-button--blob" flex>
                          <span>blob</span>
                        </div>
                      </div>
                    </div>
                    <div class="player__shots-on-hole">
                      Shots on this hole: <span>{{player.shotsOnCurrentHole}}</span>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>
      <div class="score-navigation-footer" layout vertical>
        <div class="hole-number-navigation">
          <div layout horizontal>
            <template repeat="{{hole, holeIndex in holeNumbers}}">
              <div class="hole-number"
                   hole="{{holeIndex + 1}}"
                   on-tap="{{showHoleNumber}}"
                   horizontal center-justified center layout flex>
                <div class="ink-container">
                  <paper-ripple class="circle recenteringTouch" fit></paper-ripple>
                </div>
                <div class="hole-number__text  {{holeIndex + 1 === holeNumber ? 'hole-number__text--selected' : ''}}">{{holeIndex + 1}}</div>
              </div>
            </template>
          </div>
          <div layout horizontal>
            <template repeat="{{hole, holeIndex in holeNumbers}}">
              <div class="hole-number"
                   hole="{{holeIndex + 10}}"
                   on-tap="{{showHoleNumber}}"
                   horizontal center-justified center layout flex>
                <div class="ink-container">
                  <paper-ripple class="circle recenteringTouch" fit></paper-ripple>
                </div>
                <div class="hole-number__text  {{holeIndex + 10 === holeNumber ? 'hole-number__text--selected' : ''}}">{{holeIndex + 10}}</div>
              </div>
            </template>
          </div>
        </div>
        <div flex>
          <div class="button-container" layout horizontal>
            <paper-button showing?="{{holeNumber > 1}}"
                          raised
                          class="button-container__button  previous-hole-button"
                          on-tap="{{showPreviousHole}}"
                          transition="core-transition-center"
                          flex>
                          <core-icon icon="arrow-back"></core-icon>
                            HOLE {{holeNumber === 1 ? 1 : holeNumber - 1}}</paper-button>
            <paper-button raised
                          class="scorecard-button"
                          on-tap="{{showScorecard}}"
                          transition="core-transition-center"
                          flex>SCORECARD</paper-button>
            <paper-button showing?="{{holeNumber < 18}}"
                          raised
                          class="button-container__button  next-hole-button"
                          on-tap="{{showNextHole}}"
                          transition="core-transition-center"
                          flex>HOLE {{holeNumber === 18 ? 18 : holeNumber + 1}}
                          <core-icon icon="arrow-forward"></core-icon>
            </paper-button>
          </div>
        </div>
      </div>
    </div>
  </template>
  <script>
    (function () {
      'use strict';

      Polymer({

        // Number of hole being scored
        holeNumber: 0,

        // Array to use for template to jump to holes navigation
        holeNumbers: [],

        // Array to use for template to jump to holes navigation
        nineHole: false,

        roundToScore: null,

        // When holeNumber changes sync up some updates
        holeNumberChanged: function() {
          this.setShotsOnCurrentHole();
        },

        // Set property on each player to show how many shots they receive on the current hole
        setShotsOnCurrentHole: function() {
          this.roundToScore.groupings[this.userDetails.uid].players.forEach(function(player) {
            player.shotsOnCurrentHole = this.getShots(player.handicap);
          }, this);
        },

        // Calculate shots based on relevant factors
        getShots: function(handicap) {

          var strokeIndex = parseInt(this.roundToScore.stroke[this.holeNumber - 1], 10);

          // Add 0.01 if the handicap is same as stroke so it will ceil() to 1 instead of 0.
          var shots = Math.ceil(((handicap - strokeIndex) / 18) + 0.01);

          return shots;
        },

        roundToScoreChanged: function() {

          if (this.roundToScore) {

            // Set arrays to use for jump to hole navigation
            this.holeNumbers.length = '9';

            if (this.roundToScore['length'] > 9) {
              this.nineHole = true;
            }
          }
        },

        // Transition to specific hole number
        showHoleNumber: function(event) {
          this.holeNumber = parseInt(event.currentTarget.attributes.hole.value, 10);
        },

        // Transition to previous hole
        showPreviousHole: function() {
          this.holeNumber = this.holeNumber - 1;
        },

        // Transition to next hole
        showNextHole: function() {
          this.holeNumber = this.holeNumber + 1;
        }
      });

    })();
  </script>
</polymer-element>
