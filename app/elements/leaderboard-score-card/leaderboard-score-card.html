<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="leaderboard-score-card" attributes="">
  <template>
    <link rel="stylesheet" href="leaderboard-score-card.css">

    <div class="bg" fit dummy cross-fade></div>

    <div class="main {{ {scroll: wide} | tokenList }}" flex center layout vertical hero-p>
      <div flex vertical layout
           slide-up-offscreen?="{{parentElement.selected === 'scoreCard'}}"
           cross-fade="{{!wide && parentElement.selected !== 'scoreCard'}}"
           class="card {{ {wide: wide, 'multi-column': columns>1, tvmode: tvmode} | tokenList }}"
           relative>

        <core-toolbar hidden?="{{parentElement.selected === 'scoreCard' || parentElement.selected === 'scoreGroup'}}">
          <div class="section-title">Scorecard</div>
        </core-toolbar>

        <div class="{{ {scroll: !wide} | tokenList }}" layout vertical flex>

          <div class="scorecard-empty" showing?="{{roundToScore == null}}">

            <div relative>
              <p>There are no scorecards to view.</p>
            </div>
          </div>

          <div class="scorecard-container" layout vertical flex hidden?="{{roundToScore == null}}">

            <!-- 9 hole scorecard -->
            <div class="scorecard-container" showing?="{{roundToScore.length === '9'}}">

            </div>

            <!-- 18 hole scorecard -->
            <div class="scorecard-container" showing?="{{roundToScore.length === '18'}}">


              <template repeat="{{hole, holeIndex in outNine}}">
                <div layout horizontal>
                  <div>
                    {{hole.holeNumber}}
                  </div>
                  <div>
                    {{hole.par}}
                  </div>
                  <div>
                    {{hole.stroke}}
                  </div>
                  <div>
                    {{hole.player1.scorecard}} {{hole.player1.score}}
                  </div>
                  <div>
                    {{hole.player2.scorecard}} {{hole.player2.score}}
                  </div>
                  <div>
                    {{hole.player3.scorecard}} {{hole.player3.score}}
                  </div>
                  <div>
                    {{hole.player4.scorecard}} {{hole.player4.score}}
                  </div>
                </div>
              </template>

              <template showing?="{{roundToScore.length === '18'}}" repeat="{{hole, holeIndex in inNine}}">
                <div layout horizontal>
                  <div>
                    {{hole.holeNumber}}
                  </div>
                  <div>
                    {{hole.par}}
                  </div>
                  <div>
                    {{hole.stroke}}
                  </div>
                  <div>
                    {{hole.player1.scorecard}} {{hole.player1.score}}
                  </div>
                  <div>
                    {{hole.player2.scorecard}} {{hole.player2.score}}
                  </div>
                  <div>
                    {{hole.player3.scorecard}} {{hole.player3.score}}
                  </div>
                  <div>
                    {{hole.player4.scorecard}} {{hole.player4.score}}
                  </div>
                </div>
              </template>
            </div>

          </div>
        </div>
      </div>

      <paper-icon-button class="back-button {{ {wide: wide} | tokenList }}"
                         icon="arrow-back"
                         hidden?="{{parentElement.selected === 'scoreCard'}}"
                         on-tap="{{backNavigation}}"
                         hero-id="scoreboard-back-button"
                         hero>
      </paper-icon-button>
    </div>
  </template>
  <script>
    (function () {
      'use strict';

      Polymer({

        publish: {
          roundToScore: null,
          userGrouping: null,
          holesCompleted: 0,
          scoreCardObject: null,
          outNine: [],
          inNine: [],
          userDetails: null,
          wide: false
        },

        // When roundToScore is passed in
        roundToScoreChanged: function() {

          if (this.roundToScore) {
            this.createScoreCardObject();
          }
        },

        // Update when a hole is submitted
        holesCompletedChanged: function() {
          this.createScoreCardObject();
        },

        // Create object so we can easily template the Scorecard
        createScoreCardObject: function() {

          this.setupScoreObject();
          this.setStroke();
          this.setScores();
          console.log(this.outNine);
          console.log(this.inNine);
        },

        // Set hole number and par properties and default player scores
        setupScoreObject: function() {

          var inObject;

          // Reset arrays
          this.outNine = [];
          this.inNine =[];

          for (var holeNumber in this.roundToScore.par) {

            inObject = {};
            inObject.holeNumber = parseInt(holeNumber, 10) + 1;
            inObject.par = this.roundToScore.par[holeNumber];

            inObject.player1 = {
              scorecard: '',
              score: ''
            };

            inObject.player2 = {
              scorecard: '',
              score: ''
            };

            inObject.player3 = {
              scorecard: '',
              score: ''
            };

            inObject.player4 = {
              scorecard: '',
              score: ''
            };

            if (holeNumber < 9) {
              this.outNine[holeNumber] = inObject;
            } else {
              this.inNine[holeNumber] = inObject;
            }
          }
        },

        // Set stroke property
        setStroke: function() {

          for (var holeNumber in this.roundToScore.stroke) {

            if (holeNumber < 9) {
              this.outNine[holeNumber].stroke = this.roundToScore.stroke[holeNumber];
            } else {
              this.inNine[holeNumber].stroke = this.roundToScore.stroke[holeNumber];
            }
          }
        },

        // Set scores for each player in the group
        setScores: function() {

          if (this.userGrouping) {

            for (i = 0; i < 4; i++) {

              if (this.userGrouping.players[i]) {

                if (this.userGrouping.players[i].roundScorecard) {
                  // For each score a player has made add it to the object
                  this.userGrouping.players[i].roundScorecard.forEach(function(scorecard, index) {

                    if (index < 9) {
                      this.outNine[index]['player' + (i + 1)].scorecard = scorecard;
                    } else {
                      this.inNine[index]['player' + (i + 1)].scorecard = scorecard;
                    }
                  }, this);

                  // For each points such as Stableford a player has made add it to the object
                  this.userGrouping.players[i].roundScore.forEach(function(score, index) {

                    if (index < 9) {
                      this.outNine[index]['player' + (i + 1)].score = score;
                    } else {
                      this.inNine[index]['player' + (i + 1)].score = score;
                    }
                  }, this);

                  // Clean inNine array of undefined entries
                  this.inNine = this.inNine.filter(function(hole) {
                    return hole != undefined;
                  });
                }
              }
            }
          }
        }
      });

    })();
  </script>
</polymer-element>
