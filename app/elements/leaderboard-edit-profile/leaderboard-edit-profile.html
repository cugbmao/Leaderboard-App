<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="leaderboard-edit-profile" attributes="user userDetails name handicap">
  <template>
    <link rel="stylesheet" href="leaderboard-edit-profile.css">

    <firebase-element id="user" location="{{'https://incandescent-heat-3687.firebaseio.com/users/' + user.uid}}"
                      dataReady="{{userReady}}">
    </firebase-element>

    <paper-input label="Name (optional)" floatinglabel value="{{name}}"
                 type="name" id="name_input" layout vertical>
    </paper-input>
    <paper-input label="Handicap (optional)" floatinglabel value="{{handicap}}"
                 type="handicap" id="handicap_input" layout vertical>
    </paper-input>
    <div class="button-holder" horizontal center layout>
      <paper-button raised on-tap="{{signOut}}" label="Sign Out"></paper-button>
      <div flex></div>
      <paper-fab id="CreateUserButton" icon="check" showing
                 on-tap="{{ setUserDetails }}">
      </paper-fab>
    </div>
  </template>
  <script>
    (function () {
      'use strict';

      Polymer({

        observe: {
          'userReady': 'getUserDetails'
        },

        // When a user is logged in and FireBase user element updates, set the values used by field inputs.
        getUserDetails: function() {

          if (this.$.user.data) {
            this.email = this.$.user.data.email;
            this.handicap = this.$.user.data.handicap;
            this.name = this.$.user.data.name;
            this.uid = this.$.user.data.uid;

            this.userDetails = this.$.user.data;
          }
          else if (this.userDetails){
            this.setUserDetails();
          }
        },

        // When userDetails change send it to FireBase user element
        setUserDetails: function() {

          // Focus on the fab button otherwise some mobile devices don't seem to pick up the change to the paper input
          // value in time so the value doesn't get updated correctly below.
          this.$.CreateUserButton.focus();

          if (this.userDetails && this.user) {
            this.$.user.data = {
              name: this.name || this.userDetails.name || '',
              handicap: this.handicap || this.userDetails.handicap || '',
              uid: this.user.uid || '',
              email: this.user.email || ''
            }

            this.userDetails = this.$.user.data;

            this.fire('profile-changed');
          }
        },

        // Trigger Sign Out event.
        signOut: function() {
          this.fire('sign-out-button-pressed');
        }
      });

    })();
  </script>
</polymer-element>
